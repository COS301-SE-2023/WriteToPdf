<div class="container" data-testid="home-page">
  <p-toast></p-toast>
  <div class="header">
    <div (click)="navigateToPage('home')" class="logoWrapper">
      <img alt="Home Page" class="logo" src="assets/Logos/WriteToPdf_Logo_white.png" />
    </div>
    <div class="headerNavigation">
      <div class="p-menubar custom-menubar">
        <p-menubar [autoZIndex]="false" [style.min-width]="componentWidth" [model]="menuBarItems"
          [style]="{backgroundColor: '#00000000', border: 'none', minWidth: '200px'}"></p-menubar>
      </div>
    </div>
    <!--    TODO FileManagerPopup below-->
    <div class="fileOperations-container">
      <p-dialog [(visible)]="moveDialogVisible" [style]="{ width: '50vw' }" header="Move" [focusOnShow]="true"
        (keydown.enter)="moveEntity()" (keydown.escape)="moveDialogVisible = false">
        <div class="fileOperations">
          <p>
            Move {{ getEntityToMoveName() }} to: {{ getCurrentDirectoryName() }}
          </p>
          <!-- <input type="text" pInputText [(ngModel)]="folderTo" /> -->
        </div>
        <p-button class="fileOperations-entity" (click)="moveEntity()" label="Move"></p-button>
      </p-dialog>
    </div>
    <!--    TODO FileManagerPopup above-->
    <!-- <div class="speedDialEditMenu">
      <p-speedDial
        [model]="speedDialItems"
        class="speedDial"
        direction="down"
      ></p-speedDial>
    </div> -->

    <!--    TODO FileManagerPopup below-->
    <div class="fileOperations-container">
      <p-dialog [(visible)]="createNewDocumentDialogueVisible" [modal]="true" [style]="{ width: '50vw' }"
        header="Create Document" [focusOnShow]="true" (keydown.escape)="createNewDocumentDialogueVisible = false">
        <div class="fileOperations">
          <p>Document Name:</p>
          <input
            placeholder="Document Name"
            [(ngModel)]="entityName"
            label="Document Name: "
            pInputText
            type="text"
            (keydown.enter)="createNewDocument()"
            (keydown.enter)="createNewDocumentDialogueVisible = false"
          />
          <br />
          <br />
          <p-button (click)="createNewDocument()" (click)="createNewDocumentDialogueVisible = false" label="Create"></p-button>
        </div>
      </p-dialog>
    </div>
    <!--    TODO FileManagerPopup below-->
    <div class="fileOperations-container">
      <p-dialog [(visible)]="createNewFolderDialogueVisible" [modal]="true" [style]="{ width: '50vw' }"
        header="Create Folder" [focusOnShow]="true" (keydown.escape)="createNewFolderDialogueVisible = false">
        <div class="fileOperations">
          <p class="fileOperations-entity">Folder Name:</p>
          <input
          placeholder="Folder Name"
            class="fileOperations-entity"
            [(ngModel)]="entityName"
            label="Folder Name: "
            pInputText
            type="text"
            (keydown.enter)="createNewFolder()"
            (keydown.enter)="createNewFolderDialogueVisible = false"
          />
          <br />
          <br />
          <p-button (click)="createNewFolder()" (click)="createNewFolderDialogueVisible = false" label="Create"></p-button>
        </div>
      </p-dialog>
    </div>
    <!--    TODO FileManagerPopup below-->
    <div class="fileOperations-container">
      <p-dialog [(visible)]="renameDialogueVisible" [modal]="true" [style]="{ width: '50vw' }"
        header="Rename" [focusOnShow]="true" (keydown.escape)="renameDialogueVisible = false">
        <div class="fileOperations">
          <p class="fileOperations-entity">Rename:</p>
          <input
            placeholder="{{getSelectedName()}}"
            class="fileOperations-entity"
            [(ngModel)]="entityRename"
            label="Name: "
            pInputText
            type="text"
          />
          <br />
          <br />
          <p-button (click)="renameEntity()" (click)="renameDialogueVisible = false" label="Rename"></p-button>
        </div>
      </p-dialog>
    </div>
    <!--    TODO FileManagerPopup above-->
  </div>
  <div class="leftSideBarWrapper" id="scrollingDiv">
    <div class="leftSideBarHeading">{{ getUserFirstName() }}'s Files</div>
    <div class="leftSideBarTools">
      <img
        alt="New Folder"
        (click)="createNewFolderDialogueVisible = true"
        class="icon"
        src="assets/Icons/homeIcons/leftSideBarIcons/newDirectory.png"
      />
      <img
        alt="New Document"
        (click)="createNewDocumentDialogueVisible = true"
        class="icon newDoc"
        src="assets/Icons/homeIcons/leftSideBarIcons/newDocument.png"
      />
      <div class="uploadAssetIcon">
        <img
          alt="New Scan"
          (click)="navigateToPage('camera')"
          class="icon"
          src="assets/Icons/editIcons/plus.png"
        />
        <div class="dropdownContent">
          <div class="dropdownInput" (click)="navigateToPage('camera')">
            <img class="dropdownIcon1" src="assets/Icons/editIcons/addAsset.png" alt="">
            <p class="dropdownOptions" >
              Camera
            </p>
          </div>
          <div class="dropdownInput"  (click)="showImageUploadPopup()">
            <img class="dropdownIcon2" src="assets/Icons/editIcons/upload.png" alt="">
            <p class="dropdownOptions">
              Upload
            </p>
          </div>
        </div>
      </div>

    </div>
    <div class="directoryTree">
      <p-tree class="leftTree" (onNodeSelect)="onNodeSelect($event)" [(selection)]="treeSelectedFile" [value]="iterateNodeIDRemoval(filesDirectoryTree)"
        class="w-full md:w-30rem" selectionMode="single"></p-tree>
    </div>
  </div>
  <div class="mainWindowHome" id="fadingDiv">
    <!--    TODO reimplement the directory path for this breadCrumb component after Demo2 -->
    <!--    <div class="directoryPath">-->
    <!--      <p-breadcrumb class="max-w-full" [model]="activeDirectoryItems" [home]="directoryHome" ></p-breadcrumb>-->
    <!--    </div>-->
    <!-- <div class="filterButtons">
      <p-toolbar>
        <div class="p-toolbar-group-start">
          <p-button (onClick)="reloadMainFromRoot()" class="toolbarItem" label="Root"></p-button>
          <p-toggleButton [(ngModel)]="editToggle" class="toolbarItem" offLabel="Edit" onLabel="Edit"></p-toggleButton>
          <p-toggleButton [(ngModel)]="recentToggle" class="toolbarItem" offLabel="Recent"
            onLabel="Recent"></p-toggleButton>
          <p-toggleButton [(ngModel)]="selectToggle" class="toolbarItem" offLabel="Select"
            onLabel="Select"></p-toggleButton>
        </div>
      </p-toolbar>
    </div> -->
    <div class="searchBar">
      <img alt="searchIcon" src="assets/Icons/homeIcons/mainWindow/searchIcon.png" />
      <input (input)="filterTable($event, 0)" class="search-input" placeholder="Search..." type="text" />
    </div>
    <div class="directoryContents">
      <!--      The Current directory variable below in the main view is used to allow for intelligent file placement-->
      
      <!--
      <p-treeTable class="non-selectable" appClickAtCoordinate (dblclick)="openFileDoubleClick()"
        (keydown.enter)="openFileEnter($event)" (keydown.delete)="deleteSelectedEntity($event)" #myTreeTable
        [contextMenu]="cm" [(contextMenuSelection)]="currentDirectory" (onNodeUnselect)="unselectNode($event)"
        (onNodeSelect)="selectNode($event)" [(selection)]="currentDirectory" [columns]="treeTableColumns"
        [scrollable]="true" [tableStyle]="{ 'min-width': '50rem', overflow: 'hidden' }"
        [value]="filteredFilesDirectoryTreeTable" dataKey="name" selectionMode="single">
        <ng-template let-columns pTemplate="header">
          <tr>
            <th *ngFor="let col of columns">{{ col.header }}</th>
            <div class="spinnerWrapper" *ngIf="loading"><img class="spinner"
                src="assets/Spinner/loading2.gif" title="Loading..."></div>
          </tr>
        </ng-template>
        <ng-template let-columns="columns" let-rowData="rowData" let-rowNode pTemplate="body">
          <tr cdkDrag [cdkDragDisabled]="editToggle" (cdkDragStarted)="onNodeDrag($event)"
            (cdkDragReleased)="onDragReleased($event)" [ttRow]="rowNode" [ttSelectableRow]="rowNode"
            [ttContextMenuRow]="rowNode" [ngClass]="{ 'drag-hover': isDraggingNode }"
            [attr.data-key]="getData(rowData)">
            <td *ngFor="let col of columns; let i = index" [ngClass]="{ 'p-toggler-column': i === 0 }" ttEditableColumn
              [attr.data-key]="rowData[col.key]">
              <p-treeTableToggler *ngIf="i === 0" [rowNode]="rowNode"></p-treeTableToggler>
        -->
              <!-- <p-treeTableCellEditor *ngIf="i === 0 && editToggle">
                <div class="p-2 w-15rem h-10rem drop-column">
                  <ng-template pTemplate="input">
                    <input placeholder="File Name" (focus)="valueBeforeEdit = rowData[col.field]" (focusout)="
                        onRowLabelEdit(
                          (rowData[col.field] =
                            rowData[col.field].trim() === ''
                              ? valueBeforeEdit
                              : rowData[col.field]),
                          rowNode
                        )
                      " (keydown.enter)="
                        onRowLabelEdit(
                          (rowData[col.field] =
                            rowData[col.field].trim() === ''
                              ? valueBeforeEdit
                              : rowData[col.field]),
                          rowNode
                        )
                      " [(ngModel)]="rowData[col.field]" pInputText type="text" />
                  </ng-template>
                </div>
                <ng-template pTemplate="output">{{
                  rowData[col.field]
                  }}</ng-template>
              </p-treeTableCellEditor> -->
              <!-- <ng-container *ngIf="i === 0">{{
                removeUniqueID(rowData[col.field])
                }}</ng-container> -->
              <!-- <ng-container *ngIf="i === 0 && !editToggle">{{
                rowData[col.field]
                }}</ng-container> -->
             <!-- <ng-container *ngIf="i >= 1">{{
                rowData[col.field]
                }}</ng-container>
            </td>
          </tr>
        </ng-template>
      </p-treeTable>-->
      <div class="directoryHeader">
        <div class="iconSpacing">

          <img class="icon" src="assets/Icons/editIcons/undo.svg" alt="" (click)="undoFolder()" 
          [ngClass]="{'hover': this.folderIDHistoryPosition > 0}" />

          <img class="icon" src="assets/Icons/editIcons/redo.svg" alt="" (click)="redoFolder()" 
          [ngClass]="{'hover': this.folderIDHistory.length > this.folderIDHistoryPosition + 1}"/>

        </div>
        <div class="nameHeader">
          <span>Name</span>
        </div>
        <div class="sizeHeader">
          <span>Size</span>
        </div>
        <div class="dateHeader">
          <span>Date Created</span>
        </div>
        <div class="iconSpacing">
        </div>
      </div>

      <div #directory>
      <!-- Folders Start -->
      <div *ngFor="let obj of currentFolders" class="fileItem" (dblclick) = "openFolder(obj.FolderID)"
      (click)="handleClick($event, obj)"
      (contextmenu) ="handleRightClick($event, obj)"
      [ngClass]="{
        'selectedFile': obj.Selected,
        'defaultFile': !obj.Selected,
        'drag-hover': obj.DraggedOver
      }"
      [draggable]="obj.Selected"
      (dragstart)="onDragStart($event, obj)"
      (dragover)="onDragOver($event, obj)"
      (dragleave)="onDragLeave($event, obj)"
      (drop)="onDrop($event, obj)">
        <div class="iconSpacing">
          <img class="fileItemIcon" src="assets/Icons/homeIcons/mainWindow/folder.png" alt=""/>
        </div>
        <div class="nameHeader" title="{{obj.FolderName}}">
          <span>{{obj.FolderName}}</span>
        </div>
        <div class="sizeHeader" title="{{obj.FolderName}}">
          <span></span>
        </div>
        <div class="dateHeader" title="{{formatDate(obj.DateCreated)}}">
          <span>{{formatDate(obj.DateCreated)}}</span>
        </div>
        <div class="iconSpacing">
        </div>
      </div>
      <!-- Folders End -->
      
      <!-- Files Start -->
      <div *ngFor="let obj of currentFiles" class="fileItem" (dblclick) = "onOpenFileSelect(obj.MarkdownID)" 
      (click)="handleClick($event, obj)" 
      (contextmenu) ="handleRightClick($event, obj)"
      [ngClass]="obj.Selected ? 'selectedFile' : 'defaultFile'" 
      [draggable]="obj.Selected"
      (dragstart)="onDragStart($event, obj)"
      (drop)="onDrop($event, obj)">
        <div class="iconSpacing">
          <img class="fileItemIcon" src="assets/Icons/homeIcons/mainWindow/doc.png" alt=""/>
        </div>
        <div class="nameHeader" title="{{obj.Name}}">
          <span>{{obj.Name}}</span>
        </div>
        <div class="sizeHeader" title="{{getSize(obj.Size)}}">
          <span>{{getSize(obj.Size)}}</span>
        </div>
        <div class="dateHeader" title="{{formatDate(obj.DateCreated)}}">
          <span>{{formatDate(obj.DateCreated)}}</span>
        </div>
        <div class="iconSpacing">
          <img class="fileItemIcon lockIcon" (click)="lockClick($event, obj)" (contextmenu)="lockRightClick($event, obj)" src="assets/Icons/homeIcons/mainWindow/lock.png" alt=""/>
        </div>
      </div>
      <!-- Files End -->

      </div>
    </div>
  </div>
  <p-contextMenu
    [target]="directory"
    [model]="contextMenuItems"
  ></p-contextMenu>
  <!-- file-upload-popup.component.html -->
  <p-confirmDialog [style]="{width: '50vw', minWidth:'300px'}"></p-confirmDialog>

  
</div>